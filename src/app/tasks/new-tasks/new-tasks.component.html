<div [ngSwitch]="whichView">
  <div *ngSwitchCase="'create'">
    <app-page-title [title]="'New Task'" [subbutton]="false"></app-page-title>
  </div>
  <div *ngSwitchCase="'edit'">
    <app-page-title [title]="'New Task'" [subbutton]="false"></app-page-title>
  </div>
</div>
<!-- New Task End-->
<div class="row g-3">
  <div class="col-md-7">
    <grid-main [class]="'width:100%'">
      <form [formGroup]="createForm" (ngSubmit)="onSubmit()">

        <input-text title="Name" formControlName="taskName"></input-text>
        <input-color title="Color" formControlName="color"></input-color>

        <grid-form-input [name]="'Hashlist'" [labelclass]="'requiredak'">
          <select
                type='number'
                id='hashlist'
                class='form-select'
                formControlName="hashlistId"
            >
            <option></option>
        </select>
        </grid-form-input>

        <div>
          <input-text-area title="Attack command" formControlName="attackCmd"></input-text-area>

          <button mat-icon-button matTooltip="Help" (click)="openHelpDialog()">
            <mat-icon>help</mat-icon>
          </button>

          <span  *ngIf="attckcmd.errors" [style.color]="attckcmd.errors?  'red' : null">
            Please remove manually the blacklisted Characters or use the button below!
            <br>
            <b>BlackListed Chars: {{this.getBanChar()}} </b>
            <br>
            <button class="btn btn-gray-800" (click)="onRemoveFChars()">Remove Blacklisted Chars</button>
          </span>

        </div>

        <input-text-area title="Notes" formControlName="notes"></input-text-area>

        <div fxLayout="row wrap" fxLayoutAlign="start center" fxLayoutGap="10px">

          <input-number title="Priority" formControlName="priority"></input-number>
          <input-number title="Max agents" formControlName="maxAgents"></input-number>

        </div>

        <mat-accordion>
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                <span><b>Advanced Settings</b></span>
              </mat-panel-title>
            </mat-expansion-panel-header>
              <div fxLayout="row wrap" fxLayoutAlign="start center" fxLayoutGap="10px">

                <input-number title="Chunk size" formControlName="chunkTime" [tooltip]="tasktip.chunkTime"></input-number>
                <input-number title="Status timer" formControlName="statusTimer" [tooltip]="tasktip.statusTimer"></input-number>
                <input-number title="Skip keyspace" formControlName="skipKeyspace" [tooltip]="tasktip.skipKeyspace"></input-number>
                <input-select title="Use static chunking" formControlName="staticChunks" [items]="selectStaticChunking"></input-select>
                <input-number title="if yes, chunk size:" formControlName="chunkSize"></input-number>
                <input-number title="Chunk size" formControlName="chunkTime"></input-number>
                <input-select title="Benchmark Type" formControlName="useNewBench" [items]="selectBenchmarktype"></input-select>
                <input-number title="Chunk size" formControlName="chunkTime"></input-number>
                <input-check title="CPU only" formControlName="isCpuTask" [tooltip]="tasktip.isCpuTask"></input-check>
                <input-check title="Small task" formControlName="isSmall"  [tooltip]="tasktip.isSmall"></input-check>
                <input-check title="Enforce piping" formControlName="forcePipe"  [tooltip]="tasktip.forcePipe"></input-check>

              </div>
              <hr>
              <div class="row">

                <div class="col">

                  <grid-form-input [name]="'Binary type to run task'" [labelclass]="'display-col'">
                    <select
                          type='number'
                          id='crackerBinaryId'
                          class='form-select'
                          #myBinary
                          (change)="onChangeBinary(myBinary.value)"
                          formControlName="crackerBinaryId">
                    <option *ngFor="let cb of crackertype" [value]="cb.crackerBinaryTypeId">{{ cb.typeName }}</option>
                  </select>
                  </grid-form-input>
                </div>
                <div class="col">
                  <grid-form-input [name]="'Binary type version'" [labelclass]="'display-col'">
                    <select
                          type='number'
                          id='crackerBinaryTypeId'
                          class='form-select'
                          formControlName="crackerBinaryTypeId"
                        >
                        <!-- <option [ngValue]=""  disabled="true">--<option> -->
                        <option *ngFor="let cv of crackerversions" [value]="cv.crackerBinaryId">{{ cv.version }}</option>
                    </select>
                  </grid-form-input>
                </div>
              </div>
              <hr/>
              <div class="row g-3">
                <div class="col-md-4">
                  <grid-form-input [name]="'Set Preprocessor'" [tooltip]="tasktip.preprocessorId"  [labelclass]="'display-col'">
                    <select
                          type='number'
                          id='preprocessorId'
                          class='form-select'
                          formControlName="preprocessorId"
                        >
                        <option [ngValue]="0" [defaultSelected]=true>No</option>
                        <option *ngFor="let p of prep" [ngValue]="p.preprocessorId">{{ p.name }}</option>
                    </select>
                  </grid-form-input>
                </div>
                <div class="col-md-8">
                  <div class="form-group">
                    <div class="form-outline form-input-custom">
                        <label class="form-label display-col" for="getPreprocessorCommand">
                          Preprocessor command
                          <span *ngIf="createForm.controls['preprocessorId'].value !== 0" [ngStyle]="{'color':'#88315e'}">&#9673;</span>
                        </label>
                        <textarea
                              type='text'
                              id="preprocessorCommand"
                              class='form-control'
                              formControlName="preprocessorCommand"
                              #cmdPreAttack
                        >
                        </textarea>
                    </div>
                  </div>
                </div>
              </div>
            </mat-expansion-panel>
          </mat-accordion>
      <span *ngIf="!createForm.valid && createForm.touched" class="help-block" >Please complete all the form!</span><br>
      <grid-buttons>
        <button-submit name="Cancel" [disabled]="false" type="cancel"></button-submit>
        <button-submit [name]="'Create'"></button-submit>
      </grid-buttons>
      </form>
    </grid-main>
  </div>
  <!-- TABLES -->
  <div class="col-md-5">
    <ngb-accordion #acc="ngbAccordion" [closeOthers]="true" activeIds="panel1">
      <ngb-panel id="panel0">
        <ng-template ngbPanelTitle>
          <span><b>Wordlists</b></span>
        </ng-template>
        <ng-template ngbPanelContent [collapsed]="false">
          <table style="width: 100%" class="table table-striped table-hover table-sm" datatable [dtOptions]="dtOptions">
            <thead class="thead-light">
                <tr>
                  <th class="rounded-start">
                    T<a *ngIf="createForm.controls['preprocessorId'].value !== 0">|P
                      <fa-icon
                              placement="bottom"
                              ngbTooltip='T: Task, P: Preprocessor'
                              container="body"
                              aria-hidden="true"
                      >
                      faInfoCircle
                      </fa-icon>
                    </a>
                  </th>
                  <th class="rounded-end">File Name</th>
                </tr>
              </thead>
              <tbody>
              <tr *ngFor="let f of allfiles | search:'0':'fileType'">
                  <td>
                    <form [formGroup]="createForm" novalidate>
                      <!-- Main attack checkbox -->
                      <div class="form-check" >
                        <input class="form-check-input form-check-input-gray" (change)="onChange(f.fileId, f.fileType, f.filename, 0, $event.target )" type="checkbox" [checked]="onChecked(f.fileId)">
                        <a *ngIf="createForm.controls['preprocessorId'].value !== 0">T</a>
                      </div>
                      <!-- Preprocessor checkbox -->
                      <div  class="form-check" *ngIf="createForm.controls['preprocessorId'].value !== 0" >
                        <input class="form-check-input form-check-input-violet" (change)="onChange(f.fileId, f.fileType, f.filename, 1, $event.target )" type="checkbox"><a>P</a>
                      </div>
                    </form>
                  </td>
                  <td class="width: 100px">
                    <label class="form-check-label" for="{{f.filename}}">
                      {{f.filename | shortenString:25 }}
                    </label>
                    <fa-icon *ngIf="f.isSecret === true" aria-hidden="true">faLock</fa-icon>
                    <fa-icon
                            placement="bottom"
                            [ngbTooltip]="wordlist"
                            container="body"
                            aria-hidden="true"
                    >
                    faInfoCircle
                    </fa-icon>
                    <ng-template #wordlist>
                      <div class="d-flex flex-column">
                        <span>Full Name: {{f.filename}}</span>
                        <span>Line Count: {{f.lineCount}}</span>
                        <span>Size: {{ f.size | fileSize:false}}</span>
                      </div>
                    </ng-template>
                </td>
              </tr>
            </tbody>
          </table>
        </ng-template>
      </ngb-panel>
      <ngb-panel>
        <ng-template ngbPanelTitle>
          <span><b>Rules</b></span>
        </ng-template>
        <ng-template ngbPanelContent>
          <table style="width: 100%" class="table table-striped table-hover table-sm" datatable [dtOptions]="dtOptions">
            <thead class="thead-light">
              <tr>
                  <th class="rounded-start">
                    T<a *ngIf="createForm.controls['preprocessorId'].value !== 0">|P
                      <fa-icon
                              placement="bottom"
                              ngbTooltip='T: Task, P: Preprocessor'
                              container="body"
                              aria-hidden="true"
                      >
                      faInfoCircle
                      </fa-icon>
                    </a>
                  </th>
                  <th class="rounded-end">File Name</th>
              </tr>
              </thead>
              <tbody>
              <tr *ngFor="let f of allfiles | search:'1':'fileType'">
                  <td>
                    <form [formGroup]="createForm" novalidate>
                      <!-- Main attack checkbox -->
                      <div class="form-check" >
                        <input class="form-check-input form-check-input-gray" (change)="onChange(f.fileId, f.fileType, f.filename, 0, $event.target )" type="checkbox" [checked]="onChecked(f.fileId)">
                        <a *ngIf="createForm.controls['preprocessorId'].value !== 0">T</a>
                      </div>
                      <!-- Preprocessor checkbox -->
                      <div  class="form-check" *ngIf="createForm.controls['preprocessorId'].value !== 0" >
                        <input class="form-check-input form-check-input-violet" (change)="onChange(f.fileId, f.fileType, f.filename, 1, $event.target )" type="checkbox"><a>P</a>
                      </div>
                    </form>
                  </td>
                  <td >
                    <label class="form-check-label" for="{{f.filename}}">
                      {{f.filename | shortenString:25 }}
                    </label>
                    <fa-icon *ngIf="f.isSecret === true"  aria-hidden="true">faLock</fa-icon>
                    <fa-icon
                            placement="bottom"
                            [ngbTooltip]="rules"
                            container="body"
                            aria-hidden="true"
                    >
                    faInfoCircle
                    </fa-icon>
                    <ng-template #rules>
                      <div class="d-flex flex-column">
                        <span>Full Name: {{f.filename}}</span>
                        <span>Line Count: {{f.lineCount}}</span>
                        <span>Size: {{ f.size | fileSize:false}}</span>
                      </div>
                    </ng-template>
                  </td>
              </tr>
            </tbody>
          </table>
        </ng-template>
      </ngb-panel>
      <ngb-panel>
        <ng-template ngbPanelTitle>
          <span><b>Other</b></span>
        </ng-template>
        <ng-template ngbPanelContent>
          <table style="width: 100%" class="table table-striped table-hover table-sm" datatable [dtOptions]="dtOptions" >
            <thead class="thead-light">
              <tr>
                  <th class="rounded-start">
                    T<a *ngIf="createForm.controls['preprocessorId'].value !== 0">|P
                      <fa-icon
                              placement="bottom"
                              ngbTooltip='T: Task, P: Preprocessor'
                              container="body"
                              aria-hidden="true"
                      >
                      faInfoCircle
                      </fa-icon>
                    </a>
                  </th>
                  <th class="rounded-end">File Name</th>
              </tr>
              </thead>
              <tbody>
              <tr *ngFor="let f of allfiles | search:'2':'fileType'">
                <td>
                  <form [formGroup]="createForm" novalidate>
                    <!-- Main attack checkbox -->
                    <div class="form-check" >
                      <input class="form-check-input form-check-input-gray" (change)="onChange(f.fileId, f.fileType, f.filename, 0, $event.target )" type="checkbox" [checked]="onChecked(f.fileId)">
                      <a *ngIf="createForm.controls['preprocessorId'].value !== 0">T</a>
                    </div>
                    <!-- Preprocessor checkbox -->
                    <div  class="form-check" *ngIf="createForm.controls['preprocessorId'].value !== 0" >
                      <input class="form-check-input form-check-input-violet" (change)="onChange(f.fileId, f.fileType, f.filename, 1, $event.target )" type="checkbox"><a>P</a>
                    </div>
                  </form>
                </td>
                <td class="width: 100px">
                  <label class="form-check-label" for="{{f.filename}}">
                    {{f.filename | shortenString:25 }}
                  </label>
                  <fa-icon *ngIf="f.isSecret === true" aria-hidden="true">faLock</fa-icon>
                  <fa-icon
                          placement="bottom"
                          [ngbTooltip]="other"
                          container="body"
                          aria-hidden="true"
                  >
                  faInfoCircle
                  </fa-icon>
                  <ng-template #other>
                    <div class="d-flex flex-column">
                      <span>Full Name: {{f.filename}}</span>
                      <span>Line Count: {{f.lineCount}}</span>
                      <span class="text-left">Size: {{ f.size | fileSize:false}}</span>
                    </div>
                  </ng-template>
                </td>
              </tr>
            </tbody>
          </table>
        </ng-template>
      </ngb-panel>
    </ngb-accordion>
  </div>
</div>


