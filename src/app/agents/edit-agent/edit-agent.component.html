<grid-main>
  <app-page-title [title]="'Agent Details'" [subbutton]="false"></app-page-title>
  <form [formGroup]="updateForm" (ngSubmit)="onSubmit()">
    <div fxLayout="row wrap" fxLayoutAlign="start center" fxLayoutGap="10px">

      <simulate-form-field label="Agent ID"  message="{{ showagent['agentId'] }}"></simulate-form-field>
      <simulate-form-field label="Last activity"  message="{{ showagent['lastTime'] | uiDate }}"></simulate-form-field>
      <simulate-form-field label="Last Action"  message="{{ showagent['lastAct'] }}"></simulate-form-field>
      <simulate-form-field label="IP"  message="{{ showagent['lastIp'] }}"></simulate-form-field>
      <input-check title="Active" formControlName="isActive"></input-check>

    </div>

    <mat-accordion>
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>
            <span><b>Show/Hide details</b></span>
          </mat-panel-title>
        </mat-expansion-panel-header>
          <div fxLayout="row wrap" fxLayoutAlign="start center" fxLayoutGap="10px">

              <simulate-form-field-multi label="Member of access groups" [items]="selectuserAgps" routerLink="/users/access-groups/"></simulate-form-field-multi>
              <input-text title="Machine Name" formControlName="agentName" icon="computer"></input-text>
              <input-select title="Owner" formControlName="userId" [items]="selectUsers"></input-select>
              <form [formGroup]="updateAssignForm" (ngSubmit)="onSubmit()">
                <input-select title="Assignment" formControlName="taskId" [items]="assignTasks" [isBlankOptionDisabled]="assignNew"></input-select>
              </form>
              <input-select title="Cracker errors" formControlName="ignoreErrors" [items]="selectIgnorerrors"></input-select>
              <input-text title="Extra parameters" formControlName="cmdPars"></input-text>
              <input-check title="CPU only" formControlName="cpuOnly"></input-check>
              <input-check title="Trust" formControlName="isTrusted"  tooltip="Trust agent with secret data"></input-check>

          </div>
          <hr>
          <h4 class="display-col">Agent Detailed Information</h4>
          <div fxLayout="row wrap" fxLayoutAlign="start center" fxLayoutGap="10px">

              <simulate-form-field label="Machine ID"  message="{{ showagent['uid'] }}"></simulate-form-field>
              <simulate-form-field label="Access token"  message="{{ showagent['token'] }}"></simulate-form-field>
              <simulate-form-field label="O.S." [message]="showagent['os'] === 0 ? 'Linux' : (showagent['os'] === 1 ? 'Windows' : (showagent['os'] === 2 ? 'IOS' : 'Unknown'))" icon="computer"></simulate-form-field>
              <simulate-form-field label="Graphic cards"  message="{{ showagent['devices'] }}"></simulate-form-field>

          </div>
          <simulate-form-field label="Time spent cracking"  message="{{ timespent | sectotime }}" *ngIf="timespent"></simulate-form-field>
      </mat-expansion-panel>
    </mat-accordion>

    <grid-buttons>
      <button-submit [name]="'Update'"></button-submit>
    </grid-buttons>

  </form>
</grid-main>
<!-- Graphs -->
<app-table>
  <app-page-subtitle [subtitle]="'Device(s) Temperature'"></app-page-subtitle>
  <div class="row">
    <div class="col col-12">
      <div id="tempgraph" style="height: 250px;"></div>
    </div>
  </div>
  <app-page-subtitle [subtitle]="'Device(s) Utilization'"></app-page-subtitle>
  <div class="row">
    <div class="col col-12">
      <div id="devicegraph" style="height: 250px;"></div>
    </div>
  </div>
  <app-page-subtitle [subtitle]="'Agent average CPU utilization'"></app-page-subtitle>
  <div class="row">
    <div class="col col-12">
      <div id="cpugraph" style="height: 250px;"></div>
    </div>
  </div>
</app-table>
<!-- Errors -->
<!-- <app-table>
  <app-page-subtitle [subtitle]="'Error Messages'"></app-page-subtitle>
</app-table> -->
<!-- Dispatched Chunks -->
<app-table>
  <app-page-subtitle [subtitle]="'Dispatched chunks (Latest 50)'"></app-page-subtitle>
  <div class="table-responsive">
    <table style="width: 100%" class="table table-striped table-hover table-sm" #agentchunks datatable [dtOptions]="dtOptions" [dtTrigger]="dtTrigger" id="agentchunks">
      <thead class="thead-light">
        <tr>
          <th class="rounded-start">ID</th>
          <th>Start</th>
          <th>Length</th>
          <th>Checkpoint</th>
          <th>Progress</th>
          <th>Task</th>
          <th>Dispatch time</th>
          <th>Last activity</th>
          <th>Time spent</th>
          <th>State</th>
          <th class="rounded-end">Cracked</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let gc of getchunks">
          <td>{{ gc.chunkId }}</td>
          <td>{{ gc.skip }}</td>
          <td>{{ gc.length }}</td>
          <td>{{ gc.progress }} ({{ (gc.progress)/gc.length | percent:'1.2-2' }})</td>
          <td *ngIf="gc.progress > 0">{{ gc.progress/100 }} %</td>
          <td *ngIf="!gc.progress">N/A</td>
          <td>
            <a [routerLink]="['/tasks/show-tasks',gc.taskId,'edit']">{{ gc.taskName | shortenString:15 }}</a>
          </td>
          <td>{{ gc.dispatchTime | uiDate }}</td>
          <td *ngIf="gc.solveTime === 0">(No activity)</td>
          <td *ngIf="gc.solveTime > 0"> {{ gc.solveTime | uiDate}} </td>
          <td>{{ (gc.solveTime - gc.dispatchTime) | sectotime }}</td>
          <td>
            <span class="ui-label-inner inline-flex whitespace-nowrap items-center px-2 py-0.5 rounded-md text-xs font-medium text-white capitalize badge my-0" style="{{'background-color:'+(gc.state | staticArray:'statescolor')}}">
              {{ gc.state | staticArray:'states' }}
            </span>
          </td>
          <td>
            <a *ngIf="gc.cracked > 0" [routerLink]="['/hashlists/hashes/','tasks',gc.taskId]">{{ gc.cracked }}</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</app-table>



